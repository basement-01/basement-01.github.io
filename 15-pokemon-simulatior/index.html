<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>포켓몬 포획 시뮬레이터 (Gen III/IV 방식)</title>
  <style>
    :root {
      --bg: #0f1115;
      --card: #171a22;
      --ink: #e8ecf1;
      --muted: #9aa3b2;
      --accent: #6ea8fe;
      --ok: #6ef0a7;
      --bad: #ff8a8a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: #0f1115;
      color: var(--ink);
      font-family: var(--sans);
      line-height: 1.5
    }

    header {
      padding: 22px 20px 8px;
      text-align: center
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700
    }

    header p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px
    }

    .grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(12, 1fr)
    }

    .card {
      background: var(--card);
      border: 1px solid #232833;
      border-radius: 14px;
      padding: 14px
    }

    .span6 {
      grid-column: span 6
    }

    .span12 {
      grid-column: span 12
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin: 6px 0 6px
    }

    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #2a3040;
      background: #0f131b;
      color: var(--ink);
      font-family: var(--mono)
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .help {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px
    }

    .status-group {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #2a3040;
      border-radius: 10px;
      padding: 8px 10px;
      background: #111522
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px
    }

    button {
      cursor: pointer;
      border: 1px solid #2a3040;
      background: #141a28;
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600
    }

    button.primary {
      background: linear-gradient(180deg, #2a6bff, #2158d6);
      border: 0
    }

    .result {
      font-family: var(--mono);
      white-space: pre-wrap;
      background: #0f131b;
      border: 1px solid #2a3040;
      border-radius: 12px;
      padding: 12px
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #0f131b;
      border: 1px solid #2a3040;
      color: var(--muted);
      font-size: 12px;
      margin-right: 6px
    }

    .good {
      color: var(--ok)
    }

    .bad {
      color: var(--bad)
    }

    .formula {
      font-family: var(--mono);
      font-size: 12px;
      background: #0f131b;
      border: 1px dashed #2a3040;
      border-radius: 10px;
      padding: 10px
    }

    .footer {
      color: #7e8796;
      font-size: 12px;
      text-align: center;
      margin-top: 16px
    }

    @media (max-width:900px) {
      .span6 {
        grid-column: span 12
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>포켓몬 포획 시뮬레이터</h1>
    <p>Gen III/IV 포획 공식으로 a, b를 계산해 4회 흔들림 체크를 시뮬레이션해요.</p>
  </header>

  <div class="wrap grid">
    <section class="card span6">
      <h2 style="margin:0 0 8px;font-size:16px">입력</h2>
      <div class="row">
        <div style="flex:1 1 160px">
          <label>포획률 rate (3~255)</label>
          <input id="rate" type="number" min="3" max="255" step="1" value="255" />
        </div>
        <div style="flex:1 1 160px">
          <label>볼 배율 bonus(ball)</label>
          <input id="ball" type="number" min="0" step="0.1" value="1.0" />
        </div>
      </div>
      <div class="row">
        <div style="flex:1 1 160px">
          <label>최대 HP (HPmax)</label>
          <input id="hpmax" type="number" min="1" step="1" value="100" />
        </div>
        <div style="flex:1 1 160px">
          <label>현재 HP (HPcurrent)</label>
          <input id="hpcur" type="number" min="1" step="1" value="100" />
        </div>
      </div>
      <div class="help">현재 HP는 최소 1, 최대 HP 이하여야 해요.</div>

      <label style="margin-top:10px">상태이상 bonus(status) — 하나만 선택</label>
      <div id="statusGroup" class="status-group">
        <!-- 생성은 JS에서 -->
      </div>

      <div class="btns">
        <button id="throwBtn" class="primary">볼 던지기</button>
        <button id="resetBtn">입력 초기화</button>
      </div>
    </section>

    <section class="card span6">
      <h2 style="margin:0 0 8px;font-size:16px">결과</h2>
      <div id="summary" class="row" style="margin-bottom:8px">
        <span class="pill">a=<span id="aVal">-</span></span>
        <span class="pill">b=<span id="bVal">-</span></span>
        <span class="pill">난수 4개=<span id="rollsVal">-</span></span>
      </div>
      <div id="result" class="result">여기에 결과가 표시돼요.</div>
      <div style="margin-top:10px">
        <div class="help">종합 포획 확률 p ≈
          <span id="probVal">-</span>
        </div>
      </div>
    </section>

    <section class="card span12">
      <h2 style="margin:0 0 8px;font-size:16px">공식</h2>
      <div class="formula">
        a = ⌊ ((3·HPmax − 2·HPcurrent) · rate · bonus(ball) · bonus(status)) / (3·HPmax) ⌋<br />
        a ≥ 255 이면 즉시 포획 (100%)<br />
        b = ⌊ 65535 · 4√(a/255) ⌋ (a &lt; 255 일 때)<br />
        흔들림 체크: 0..65535 사이 난수 4개 생성, 각 난수가 b 보다 작으면 성공. 모두 성공하면 3번 흔들리고 포획 성공.<br />
        종합 확률 p ≈ (b / 65536)<sup>4</sup> (a ≥ 255 인 경우 p = 1)
      </div>
      <div class="help">
        본 로직은 Gen III/IV 포획/흔들림 공식과 0..65535 비교 규칙을 따릅니다. :contentReference[oaicite:1]{index=1}
      </div>
    </section>
  </div>

  <div class="footer">tip: “볼 배율”과 “상태이상”을 바꿔가며 난수 4개와 흔들림 결과를 확인해 보세요!</div>

  <script>
    // 상태 옵션 (요청하신 표를 그대로 적용)
    const STATUS_OPTIONS = [
      { key: "none", label: "없음 ×1.0", mult: 1.0 },
      { key: "confuse", label: "혼란 ×1.0", mult: 1.0 },
      { key: "poison", label: "독 ×1.5", mult: 1.5 },
      { key: "badpoison", label: "맹독 ×1.5", mult: 1.5 },
      { key: "burn", label: "화상 ×1.5", mult: 1.5 },
      { key: "paralyze", label: "마비 ×1.5", mult: 1.5 },
      { key: "freeze", label: "얼음 ×2.0", mult: 2.0 },
      { key: "sleep", label: "잠듦 ×2.0", mult: 2.0 },
      { key: "sleepPara", label: "마비잠듦 ×3.0", mult: 3.0 } // 사용자가 요청한 커스텀 항목
    ];

    // UI 요소
    const rateEl = document.getElementById('rate');
    const ballEl = document.getElementById('ball');
    const hpmaxEl = document.getElementById('hpmax');
    const hpcurEl = document.getElementById('hpcur');
    const statusGroup = document.getElementById('statusGroup');
    const throwBtn = document.getElementById('throwBtn');
    const resetBtn = document.getElementById('resetBtn');

    const aVal = document.getElementById('aVal');
    const bVal = document.getElementById('bVal');
    const rollsVal = document.getElementById('rollsVal');
    const resultBox = document.getElementById('result');
    const probVal = document.getElementById('probVal');

    // 상태 라디오 생성
    STATUS_OPTIONS.forEach((opt, i) => {
      const id = 'status_' + opt.key;
      const wrap = document.createElement('label');
      wrap.className = 'status';
      wrap.innerHTML = `
      <input type="radio" name="status" id="${id}" value="${opt.mult}" ${i === 0 ? 'checked' : ''} />
      <span>${opt.label}</span>
    `;
      statusGroup.appendChild(wrap);
    });

    function getSelectedStatusMult() {
      const sel = document.querySelector('input[name="status"]:checked');
      return sel ? parseFloat(sel.value) : 1.0;
    }

    function clamp(v, min, max) { return Math.min(Math.max(v, min), max); }

    function calcA(hpmax, hpcur, rate, ball, status) {
      const top = (3 * hpmax - 2 * hpcur);
      const raw = (top * rate * ball * status) / (3 * hpmax);
      return Math.floor(raw);
    }

    function calcB(a) {
      if (a >= 255) return 65535; // 의미상 안쓰이지만 표기용
      const ratio = a / 255;
      if (ratio <= 0) return 0;
      const fourth = Math.pow(ratio, 0.25);
      return Math.floor(65535 * fourth);
    }

    function formatPct(p) {
      return (Math.round(p * 1000) / 10).toFixed(1) + "%";
    }

    function simulateOnce() {
      // 입력값 수집 및 정리
      const hpmax = Math.max(1, Math.floor(Number(hpmaxEl.value || 0)));
      let hpcur = Math.max(1, Math.floor(Number(hpcurEl.value || 0)));
      if (hpcur > hpmax) hpcur = hpmax;

      const rate = clamp(Math.floor(Number(rateEl.value || 255)), 3, 255);
      const ball = Number(ballEl.value || 1.0);
      const status = getSelectedStatusMult();

      // 계산 a
      const a = calcA(hpmax, hpcur, rate, ball, status);
      aVal.textContent = String(a);

      if (a >= 255) {
        bVal.textContent = "—";
        rollsVal.textContent = "—";
        probVal.textContent = "100.000%";
        resultBox.innerHTML =
          `a ≥ 255 → 포획 확정!\n` +
          `설정값: rate=${rate}, ball×=${ball}, status×=${status}, HP ${hpcur}/${hpmax}\n` +
          `결과: 3번 흔들리고 포획 성공 (확률 100%)`;
        return;
      }

      // b 계산
      const b = calcB(a);
      bVal.textContent = String(b);

      // 난수 4개 (0..65535 inclusive)
      const rolls = Array.from({ length: 4 }, () => Math.floor(Math.random() * 65536));
      rollsVal.textContent = rolls.join(", ");

      // 흔들림 체크
      let shakes = 0;
      let caught = true;
      for (let i = 0; i < 4; i++) {
        if (rolls[i] < b) {
          shakes++;
        } else {
          caught = false;
          break;
        }
      }

      // 표기용 흔들림(성공시 3표기)
      const shownShakes = caught ? 3 : shakes;

      // 이론 포획 확률
      const p = Math.pow(b / 65536, 4);
      probVal.textContent = formatPct(p);

      // 결과 메시지
      const lines = [];
      lines.push(`설정값: rate=${rate}, ball×=${ball}, status×=${status}, HP ${hpcur}/${hpmax}`);
      lines.push(`a=${a}, b=${b}`);
      lines.push(`난수: [${rolls.join(", ")}]`);
      if (caught) {
        lines.push(`결과: ${shownShakes}번 흔들리고 포획 성공`);
        lines.push(`(동일 설정의 이론 확률 p ≈ ${formatPct(p)})`);
      } else {
        lines.push(`결과: ${shownShakes}번 흔들리고 탈출`);
        lines.push(`(동일 설정의 이론 확률 p ≈ ${formatPct(p)})`);
      }
      resultBox.innerHTML = lines.join("\n");
    }

    throwBtn.addEventListener('click', simulateOnce);
    resetBtn.addEventListener('click', () => {
      rateEl.value = 255;
      ballEl.value = 1.0;
      hpmaxEl.value = 100;
      hpcurEl.value = 100;
      document.getElementById('status_none').checked = true;
      aVal.textContent = bVal.textContent = rollsVal.textContent = "-";
      probVal.textContent = "-";
      resultBox.textContent = "여기에 결과가 표시돼요.";
    });
  </script>
</body>

</html>